function Snake(t,s){this.body=[[t[0],t[1]-2],[t[0],t[1]-1],[t[0],t[1]]],this.currentDirection=RIGHT_ARROW,this.numRays=8,this.food,this.rays=new Array(this.numRays),this.hitmap=new Array(3*this.numRays),this.brain=s,this.dist=0,this.getSize=function(){return this.body.length},this.setFood=function(t){this.food=t},this.getBrain=function(){return this.brain},this.move=function(t){return this.body.push(t),!!this.hitsTheFood(t[0],t[1])||(this.body.shift(),!1)},this.getHead=function(){return[...this.body[this.body.length-1]]},this.drawSnake=function(){fill(50),stroke(0);for(var t=0;t<this.body.length;t++)i=this.body[t][0],j=this.body[t][1],t==this.body.length-1&&fill(0,150,150),rect(j*RESOLUTION,i*RESOLUTION,RESOLUTION,RESOLUTION)},this.update=function(){switch(this.updateRays(),input=this.buildInput(),this.currentDirection=this.brain.predict(input),head=this.getHead(),this.currentDirection){case UP_ARROW:head[0]--;break;case DOWN_ARROW:head[0]++;break;case LEFT_ARROW:head[1]--;break;case RIGHT_ARROW:head[1]++}return this.canMove=!1,this.isValid(head)?(foodWasEaten=this.move(head),foodWasEaten?FOOD_WAS_EATEN:IS_ALIVE):IS_DEAD},this.buildInput=function(){input=[];for(let t=0;t<this.numRays;t++)input[3*t]=this.rayMagnitude(3*t),input[3*t+1]=0==this.hitmap[3*t+1]?0:this.rayMagnitude(3*t+1),input[3*t+2]=0==this.hitmap[3*t+2]?0:this.rayMagnitude(3*t+2);return input.push(this.body.length/pow(RESOLUTION-2,2)),input},this.updateRays=function(){head=this.getHead();for(let t=0;t<this.numRays;t++)this.rays[t]=[...head];for(let t=0;t<3*this.numRays;t++)this.hitmap[t]=0;noStroke();for(let t=0;t<this.numRays;t++)this.rayCast(t);stroke(0)},this.rayCast=function(t){for(this.dist=0;!this.hitsTheWall(this.rays[t][0],this.rays[t][1]);)this.dist++,this.increaseRay(t),visualizeRays&&(this.chooseColor(t),ellipse(this.rays[t][1]*RESOLUTION,this.rays[t][0]*RESOLUTION,5))},this.chooseColor=function(t){switch(this.hitmap[t][0]){case 0:fill(150);break;case 1:fill(200,0,0);break;case 2:fill(0,200,0);break;case 3:fill(0,0,200)}},this.rayMagnitude=function(t){return map(this.hitmap[t],1,CANVAS_DIMENSION_SNAKE/RESOLUTION-2,1,0)},this.increaseRay=function(t){switch(t){case 0:this.rays[t][1]++;break;case 1:this.rays[t][0]++,this.rays[t][1]++;break;case 2:this.rays[t][0]++;break;case 3:this.rays[t][0]++,this.rays[t][1]--;break;case 4:this.rays[t][1]--;break;case 5:this.rays[t][0]--,this.rays[t][1]--;break;case 6:this.rays[t][0]--;break;case 7:this.rays[t][0]--,this.rays[t][1]++}this.updateHitmap(t)},this.updateHitmap=function(t){this.hitsTheWall(this.rays[t][0],this.rays[t][1])&&(this.hitmap[3*t]=this.dist),0==this.hitmap[3*t+1]&&this.hitsTheBody(this.rays[t][0],this.rays[t][1])&&(this.hitmap[3*t+1]=this.dist),this.hitsTheFood(this.rays[t][0],this.rays[t][1])&&(this.hitmap[3*t+2]=this.dist)},this.hitsTheFood=function(t,i){return t==this.food[0]&&i==this.food[1]},this.hitsTheWall=function(t,i){return t>=CANVAS_DIMENSION_SNAKE/RESOLUTION-1||0==t||i>=CANVAS_DIMENSION_SNAKE/RESOLUTION-1||0==i},this.hitsTheBody=function(t,i){for(let s=0;s<this.body.length-1;s++)if(this.body[s][0]==t&&this.body[s][1]==i)return!0;return!1},this.isValid=function(t){return i=t[0],j=t[1],!this.hitsTheWall(i,j)&&!this.hitsTheBody(i,j)}}var visualizeRays=!1;